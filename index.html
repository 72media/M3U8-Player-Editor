<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>M3U8 Player ‡πÅ‡∏•‡∏∞ Editor</title>
  <style>
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
    body {
      background-color: #222;
      color: #fff;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ */
    .tv-container {
      width: 100%;
      max-width: 900px;
      position: relative;
      margin-bottom: 30px;
    }

    .tv-frame {
      background: #111;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(0, 184, 148, 0.3);
      position: relative;
      overflow: hidden;
    }

    .tv-screen {
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      aspect-ratio: 16/9;
    }

    .tv-stand {
      width: 200px;
      height: 30px;
      background: linear-gradient(to right, #333, #444, #333);
      margin: 0 auto;
      border-radius: 0 0 10px 10px;
      position: relative;
      top: -10px;
      z-index: -1;
    }

    .tv-stand:after {
      content: '';
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 20px;
      background: #222;
      border-radius: 0 0 5px 5px;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .youtube-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .control-panel {
      background: #1a1a1a;
      border-radius: 0 0 10px 10px;
      padding: 20px;
      margin-top: -10px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    .input-container {
      width: 100%;
      margin-bottom: 15px;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 15px;
      font-size: 16px;
      margin-bottom: 10px;
      background: #333;
      border: 1px solid #444;
      color: #fff;
      border-radius: 6px;
    }

    button {
      padding: 12px 25px;
      font-size: 16px;
      background: #00b894;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.3s;
    }

    button:hover {
      background: #00a884;
      transform: translateY(-2px);
    }

    button.secondary {
      background: #555;
    }

    button.secondary:hover {
      background: #666;
    }

    .file-upload {
      margin: 15px 0;
      padding: 25px;
      border: 2px dashed #444;
      border-radius: 8px;
      text-align: center;
      background: #1a1a1a;
      transition: all 0.3s;
    }

    .file-upload:hover {
      border-color: #00b894;
      background: #222;
    }

    .file-upload p {
      margin: 0;
      color: #aaa;
    }

    .channel-selector {
      width: 100%;
      padding: 12px 15px;
      font-size: 16px;
      margin-bottom: 15px;
      background: #333;
      border: 1px solid #444;
      color: #fff;
      border-radius: 6px;
      display: none;
    }

    .tab-container {
      display: flex;
      margin-bottom: 15px;
      width: 100%;
    }

    .tab {
      padding: 12px 25px;
      background: #333;
      cursor: pointer;
      margin-right: 5px;
      border-radius: 6px 6px 0 0;
      transition: all 0.3s;
    }

    .tab.active {
      background: #00b894;
    }

    .editor-tab {
      padding: 12px 25px;
      background: #444;
      cursor: pointer;
      margin-right: 5px;
      border-radius: 6px 6px 0 0;
      transition: all 0.3s;
    }

    .editor-tab:hover {
      background: #555;
    }

    .tab-content {
      display: none;
      width: 100%;
    }

    .tab-content.active {
      display: block;
    }

    .tv-brand {
      position: absolute;
      top: 80px;
      right: 30px;
      color: #00b894;
      font-size: 14px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .power-button {
      position: absolute;
      top: 15px;
      left: 30px;
      width: 12px;
      height: 12px;
      background: #ff3b30;
      border-radius: 50%;
      box-shadow: 0 0 5px #ff3b30;
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    .button-group button {
      flex: 1;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô Editor */
    .editor-container {
      width: 100%;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Å‡∏î‡πÄ‡∏õ‡∏¥‡∏î */
      margin-top: 20px;
    }

    .editor-title {
      color: #00b894;
      text-align: center;
      margin-bottom: 20px;
    }

    .editor-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .editor-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .editor-table th, .editor-table td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }

    .editor-table th {
      background-color: #333;
      color: #00b894;
    }

    .editor-table tr:nth-child(even) {
      background-color: #222;
    }

    .editor-table tr:hover {
      background-color: #333;
    }

    .editor-table input {
      width: 100%;
      padding: 8px;
      background: #333;
      border: 1px solid #444;
      color: #fff;
      border-radius: 4px;
    }

    .editor-table button {
      padding: 6px 12px;
      font-size: 14px;
    }

    .youtube-icon {
      color: #ff0000;
      margin-right: 5px;
    }

    @media (max-width: 768px) {
      .tv-frame {
        padding: 10px;
      }
      
      .tab, .editor-tab {
        padding: 10px 15px;
        font-size: 14px;
      }
      
      button {
        padding: 10px 15px;
      }
      
      .file-upload {
        padding: 15px;
      }

      .editor-controls {
        flex-direction: column;
      }

      .editor-table {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ -->
    <div class="tv-container">
      <div class="tv-frame">
        <div class="tv-screen" id="video-container">
          <video id="m3u8-player" controls autoplay></video>
        </div>
        <div class="tv-stand"></div>
      </div>

      <div class="control-panel">
        <h2 style="text-align: center; margin-top: 0; color: #00b894;">‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå m3u8 ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå m3u ‡πÑ‡∏î‡πâ</h2>
        
        <div class="tab-container">
          <div class="tab active" onclick="switchTab('url-tab')">‡πÉ‡∏ä‡πâ URL</div>
          <div class="tab" onclick="switchTab('file-tab')">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</div>
          <div class="tab" onclick="switchTab('youtube-tab')"><span class="youtube-icon">‚ñ∂Ô∏è</span>YouTube</div>
          <div class="editor-tab" onclick="toggleEditor()">Editor Playlist</div>
        </div>
        
        <div id="url-tab" class="tab-content active">
          <div class="input-container">
            <input type="text" id="m3u8-url" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå .m3u8 ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô https://..." />
            <button onclick="playFromUrl()">‡πÄ‡∏•‡πà‡∏ô</button>
          </div>
        </div>
        
        <div id="file-tab" class="tab-content">
          <div class="input-container">
            <div class="file-upload" id="drop-zone">
              <p>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå M3U ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
              <input type="file" id="m3u-file" accept=".m3u,.m3u8" style="display: none;" />
            </div>
            <select id="channel-select" class="channel-selector">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á --</option>
            </select>
            <div class="button-group">
              <button onclick="playFromFile()" id="play-file-btn" disabled>‡πÄ‡∏•‡πà‡∏ô</button>
              <button onclick="clearM3UFile()" id="clear-file-btn" class="secondary" disabled>‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå</button>
            </div>
          </div>
        </div>

        <!-- ‡πÅ‡∏ó‡πá‡∏ö YouTube ‡πÉ‡∏´‡∏°‡πà -->
        <div id="youtube-tab" class="tab-content">
          <div class="input-container">
            <input type="text" id="youtube-url" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô https://www.youtube.com/watch?v=..." />
            <button onclick="playFromYouTube()">‡πÄ‡∏•‡πà‡∏ô YouTube</button>
          </div>
        </div>

        <div id="editor-tab" class="tab-content">
          <div class="input-container">
            <button onclick="loadCurrentPlaylistToEditor()">‡πÇ‡∏´‡∏•‡∏î Playlist ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
            <p>‡∏´‡∏£‡∏∑‡∏≠</p>
            <div class="file-upload" id="editor-drop-zone">
              <p>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå M3U ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
              <input type="file" id="editor-m3u-file" accept=".m3u,.m3u8" style="display: none;" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô Editor -->
    <div class="editor-container" id="editor-container">
      <h2 class="editor-title">M3U Playlist Editor</h2>
      
      <div class="editor-controls">
        <input type="text" id="filterInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á..." />
        <button onclick="loadCurrentPlaylistToEditor()">‡πÇ‡∏´‡∏•‡∏î Playlist ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
        <button onclick="addChannel()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        <button onclick="exportM3U()">üíæ Export .m3u (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</button>
        <button onclick="exportM3UByGroup()">üíæ Export ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Group</button>
      </div>

      <div class="input-container">
        <div class="file-upload" id="editor-drop-zone">
          <p>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå M3U ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
          <input type="file" id="editor-m3u-file" accept=".m3u,.m3u8" style="display: none;" />
        </div>
      </div>

      <table class="editor-table" id="channelTable">
        <thead>
          <tr>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á</th>
            <th>group-title</th>
            <th>logo</th>
            <th>URL</th>
            <th>‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ‡πÇ‡∏´‡∏•‡∏î HLS.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
    let hls;
    let m3uContent = '';
    let channels = [];
    let playlist = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• playlist ‡πÉ‡∏ô editor
    let editorVisible = false;

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ drag and drop ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    document.addEventListener('DOMContentLoaded', function() {
      setupDragAndDrop();
      setupEditorDragAndDrop();
    });

    function toggleEditor() {
      editorVisible = !editorVisible;
      const editorContainer = document.getElementById('editor-container');
      const editorTab = document.querySelector('.editor-tab');
      
      if (editorVisible) {
        editorContainer.style.display = 'block';
        editorTab.style.background = '#00b894';
        updateEditorPlaylist();
      } else {
        editorContainer.style.display = 'none';
        editorTab.style.background = '#444';
      }
    }

    function setupDragAndDrop() {
      const dropZone = document.getElementById('drop-zone');
      const fileInput = document.getElementById('m3u-file');
      
      // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà drop zone ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
      dropZone.addEventListener('click', function() {
        fileInput.click();
      });

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#00b894';
        dropZone.style.background = '#222';
      });
      
      dropZone.addEventListener('dragleave', () => {
        dropZone.style.borderColor = '#444';
        dropZone.style.background = '#1a1a1a';
      });
      
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#444';
        dropZone.style.background = '#1a1a1a';
        
        const file = e.dataTransfer.files[0];
        if (!file) return;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå M3U ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!file.name.match(/\.(m3u|m3u8)$/i)) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå .m3u ‡∏´‡∏£‡∏∑‡∏≠ .m3u8 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
          return;
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏¥‡∏•‡πå‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï
        fileInput.files = e.dataTransfer.files;
        handleFileUpload(file);
      });

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å
      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) handleFileUpload(file);
      });
    }

    function switchTab(tabId) {
      // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      document.getElementById(tabId).classList.add('active');
      event.currentTarget.classList.add('active');
    }

    function playFromUrl() {
      const videoContainer = document.getElementById('video-container');
      const url = document.getElementById('m3u8-url').value;

      if (!url) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå M3U8 ‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }

      // ‡∏•‡πâ‡∏≤‡∏á iframe YouTube ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      videoContainer.innerHTML = '<video id="m3u8-player" controls autoplay></video>';
      
      playStream(url);
    }

    function playFromYouTube() {
      const videoContainer = document.getElementById('video-container');
      const youtubeUrl = document.getElementById('youtube-url').value;
      
      if (!youtubeUrl) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      
      // ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ
      let videoId = '';
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
      const match = youtubeUrl.match(regExp);
      
      if (match && match[2].length === 11) {
        videoId = match[2];
      } else {
        alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå embed ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô YouTube
      const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1`;
      
      // ‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      if (hls) {
        hls.destroy();
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á iframe ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô YouTube
      videoContainer.innerHTML = `
        <iframe 
          id="youtube-player"
          class="youtube-iframe" 
          src="${embedUrl}" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen>
        </iframe>
      `;
    }

    function playFromFile() {
      const videoContainer = document.getElementById('video-container');
      const channelSelect = document.getElementById('channel-select');
      const selectedUrl = channelSelect.value;
      
      if (!selectedUrl) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô');
        return;
      }
      
      // ‡∏•‡πâ‡∏≤‡∏á iframe YouTube ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      videoContainer.innerHTML = '<video id="m3u8-player" controls autoplay></video>';
      
      playStream(selectedUrl);
    }

    function clearM3UFile() {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á input ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°
      const fileInput = document.getElementById('m3u-file');
      const newFileInput = fileInput.cloneNode(true);
      fileInput.parentNode.replaceChild(newFileInput, fileInput);
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï dropdown ‡∏ä‡πà‡∏≠‡∏á
      const channelSelect = document.getElementById('channel-select');
      channelSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á --</option>';
      channelSelect.style.display = 'none';
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
      const dropZone = document.getElementById('drop-zone');
      dropZone.innerHTML = '<p>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå M3U ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>';
      dropZone.style.borderColor = '#444';
      dropZone.style.background = '#1a1a1a';
      
      // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°
      document.getElementById('play-file-btn').disabled = true;
      document.getElementById('clear-file-btn').disabled = true;
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
      m3uContent = '';
      channels = [];
      
      // ‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà
      const videoContainer = document.getElementById('video-container');
      videoContainer.innerHTML = '<video id="m3u8-player" controls autoplay></video>';
      if (hls) {
        hls.destroy();
        hls = null;
      }
      
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ drag and drop ‡πÉ‡∏´‡∏°‡πà
      setupDragAndDrop();
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó playlist ‡πÉ‡∏ô editor
      updateEditorPlaylist();
    }

    function handleFileUpload(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        m3uContent = e.target.result;
        parseM3UFile(m3uContent);
      };
      reader.readAsText(file);
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      const dropZone = document.getElementById('drop-zone');
      dropZone.innerHTML = `<p>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <strong>${file.name}</strong></p>`;
      
      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå
      document.getElementById('clear-file-btn').disabled = false;
    }

    function parseM3UFile(content) {
      const lines = content.split('\n');
      channels = [];
      let currentChannel = {};
      
      lines.forEach(line => {
        line = line.trim();
        
        if (line.startsWith('#EXTINF:')) {
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á
          const info = line.substring(8).split(',');
          currentChannel.duration = info[0];
          currentChannel.name = info.slice(1).join(',').trim();
          
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å attributes
          const logoMatch = line.match(/tvg-logo="([^"]*)"/);
          const groupMatch = line.match(/group-title="([^"]*)"/);
          
          currentChannel.logo = logoMatch ? logoMatch[1] : '';
          currentChannel.group = groupMatch ? groupMatch[1] : '';
        } else if (line && !line.startsWith('#') && line.startsWith('http')) {
          // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ URL
          currentChannel.url = line.trim();
          channels.push(currentChannel);
          currentChannel = {};
        }
      });
      
      // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô dropdown
      const channelSelect = document.getElementById('channel-select');
      channelSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á --</option>';
      
      channels.forEach(channel => {
        const option = document.createElement('option');
        option.value = channel.url;
        option.textContent = channel.name || '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
        channelSelect.appendChild(option);
      });
      
      // ‡πÅ‡∏™‡∏î‡∏á dropdown ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô
      channelSelect.style.display = 'block';
      document.getElementById('play-file-btn').disabled = channels.length === 0;
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó playlist ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö editor
      updateEditorPlaylist();
    }

    function playStream(url) {
      const videoContainer = document.getElementById('video-container');
      const video = document.getElementById('m3u8-player');

      // ‡∏•‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      if (hls) {
        hls.destroy();
      }

      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Safari
        video.src = url;
        video.addEventListener('loadedmetadata', function () {
          video.play();
        });
      } else {
        alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö HLS (m3u8)');
      }
    }

    // ‡∏™‡πà‡∏ß‡∏ô Editor
    function setupEditorDragAndDrop() {
      const dropZone = document.getElementById('editor-drop-zone');
      const fileInput = document.getElementById('editor-m3u-file');
      
      // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà drop zone ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
      dropZone.addEventListener('click', function() {
        fileInput.click();
      });

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#00b894';
        dropZone.style.background = '#222';
      });
      
      dropZone.addEventListener('dragleave', () => {
        dropZone.style.borderColor = '#444';
        dropZone.style.background = '#1a1a1a';
      });
      
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#444';
        dropZone.style.background = '#1a1a1a';
        
        const file = e.dataTransfer.files[0];
        if (!file) return;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå M3U ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!file.name.match(/\.(m3u|m3u8)$/i)) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå .m3u ‡∏´‡∏£‡∏∑‡∏≠ .m3u8 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
          return;
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏¥‡∏•‡πå‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï
        fileInput.files = e.dataTransfer.files;
        loadPlaylistToEditor(file);
      });

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å
      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) loadPlaylistToEditor(file);
      });
    }

    function loadPlaylistToEditor(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = e.target.result;
        parsePlaylistForEditor(content);
      };
      reader.readAsText(file);
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      const dropZone = document.getElementById('editor-drop-zone');
      dropZone.innerHTML = `<p>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <strong>${file.name}</strong></p>`;
    }

    function loadCurrentPlaylistToEditor() {
      if (channels.length === 0) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ playlist ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      
      playlist = [...channels];
      renderEditorTable();
    }

    function parsePlaylistForEditor(content) {
      const lines = content.split('\n');
      playlist = [];
      let currentChannel = {};
      
      lines.forEach(line => {
        line = line.trim();
        
        if (line.startsWith('#EXTINF:')) {
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á
          const info = line.substring(8).split(',');
          currentChannel.name = info.slice(1).join(',').trim();
          
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å attributes
          const logoMatch = line.match(/tvg-logo="([^"]*)"/);
          const groupMatch = line.match(/group-title="([^"]*)"/);
          
          currentChannel.logo = logoMatch ? logoMatch[1] : '';
          currentChannel.group = groupMatch ? groupMatch[1] : '';
        } else if (line && !line.startsWith('#') && line.startsWith('http')) {
          // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ URL
          currentChannel.url = line.trim();
          playlist.push(currentChannel);
          currentChannel = {};
        }
      });
      
      renderEditorTable();
    }

    function updateEditorPlaylist() {
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó playlist ‡πÉ‡∏ô editor ‡∏à‡∏≤‡∏Å channels ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      if (editorVisible) {
        playlist = [...channels];
        renderEditorTable();
      }
    }

    function renderEditorTable() {
      const filter = document.getElementById('filterInput').value.toLowerCase();
      const tbody = document.querySelector('#channelTable tbody');
      tbody.innerHTML = '';
      
      playlist.forEach((item, index) => {
        if (item.name && item.name.toLowerCase().includes(filter)) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><input value="${item.name || ''}" onchange="updateChannel(${index}, 'name', this.value)"></td>
            <td><input value="${item.group || ''}" onchange="updateChannel(${index}, 'group', this.value)"></td>
            <td><input value="${item.logo || ''}" onchange="updateChannel(${index}, 'logo', this.value)"></td>
            <td><input value="${item.url || ''}" onchange="updateChannel(${index}, 'url', this.value)"></td>
            <td>
              <button onclick="removeChannel(${index})">üóëÔ∏è ‡∏•‡∏ö</button>
            </td>
          `;
          tbody.appendChild(row);
        }
      });
    }

    function updateChannel(index, field, value) {
      playlist[index][field] = value;
    }

    function removeChannel(index) {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')) {
        playlist.splice(index, 1);
        renderEditorTable();
      }
    }

    function addChannel() {
      playlist.push({ 
        name: '‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 
        group: '', 
        logo: '', 
        url: 'http://' 
      });
      renderEditorTable();
    }

    document.getElementById('filterInput').addEventListener('input', renderEditorTable);

    function exportM3U() {
      let content = '#EXTM3U\n';
      playlist.forEach((item) => {
        content += `#EXTINF:-1 tvg-logo="${item.logo || ''}" group-title="${item.group || ''}",${item.name || ''}\n${item.url || ''}\n`;
      });
      
      const blob = new Blob([content], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'playlist-edited.m3u';
      a.click();
    }

    function exportM3UByGroup() {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏° group-title
      const groups = {};
      playlist.forEach(item => {
        const groupName = item.group || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';
        if (!groups[groupName]) groups[groupName] = [];
        groups[groupName].push(item);
      });

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°
      Object.keys(groups).forEach(groupName => {
        let content = '#EXTM3U\n';
        groups[groupName].forEach(item => {
          content += `#EXTINF:-1 tvg-logo="${item.logo || ''}" group-title="${item.group || ''}",${item.name || ''}\n${item.url || ''}\n`;
        });

        const blob = new Blob([content], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
        const safeGroupName = groupName.replace(/[^a-z0-9‡∏Å-‡πô]/gi, '_').toLowerCase();
        a.download = `playlist-${safeGroupName}.m3u`;
        a.click();
      });
    }
  </script>
</body>
</html>
